---
title: Image State API
---

## Overview

The editor persists the *working* image transform (position/scale/rotation) per project so the canvas can be restored on reload.

Endpoint:

- `GET /api/projects/:projectId/image-state`
- `POST /api/projects/:projectId/image-state`

Auth:

- Requires an authenticated Supabase user (cookie-based auth via SSR client).
- Project access is enforced via RLS and an explicit "project accessible" check.

## Data model (DB)

Table: `public.project_image_state`

Key:

- `(project_id, role)` where `role` is `master` or `working`

Fields:

- **transform**: `x`, `y`, `scale_x`, `scale_y`, `rotation_deg`
- **optional cached size**: `width_px`, `height_px` (numeric, > 0 when present)
- **optional display meta**: `unit` (`measure_unit`) and `dpi` (numeric, > 0 when present)

## GET response

```json
{
  "exists": true,
  "state": {
    "project_id": "uuid",
    "role": "master",
    "x": 123.45,
    "y": 67.89,
    "scale_x": 1.0,
    "scale_y": 1.0,
    "rotation_deg": 0,
    "width_px": 1024.5,
    "height_px": 768.25,
    "unit": "cm",
    "dpi": 300
  }
}
```

If no state exists:

```json
{ "exists": false, "state": null }
```

## POST payload

```json
{
  "role": "master",
  "x": 123.45,
  "y": 67.89,
  "scale_x": 1.0,
  "scale_y": 1.0,
  "rotation_deg": 0,
  "width_px": 1024.5,
  "height_px": 768.25,
  "unit": "cm",
  "dpi": 300
}
```

Notes:

- `width_px/height_px/unit/dpi` are optional; the editor can compute display values from other sources.
- The route is backward-compatible: if DB columns don't exist yet, the API falls back to the legacy selection/upsert without those columns.

